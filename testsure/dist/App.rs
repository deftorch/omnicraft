//! Generated by OmniCraft Compiler
//! Source: App.omni
//! Do not edit manually.

#![allow(unused)]

use omnicraft_runtime::prelude::*;
use wasm_bindgen::prelude::*;

/// App
#[wasm_bindgen]
pub struct AppComponent {
}

impl OmniComponent for AppComponent {
    fn create(ctx: &mut Context) -> Self {
        Self {
        }
    }

    fn mount(&self, world: &mut World) {
        world.set_canvas_width(800.0);
        world.set_canvas_height(600.0);

        let entity_0 = world.spawn_empty().id();
        world.entity_mut(entity_0).insert(Transform::from_xy(400.0, 300.0));
        world.entity_mut(entity_0).insert(Shape::Circle { radius: 50.0 });
        world.entity_mut(entity_0).insert(Style { fill: Some(Color::parse("#00d4ff")), stroke: None, ..Default::default() });

        let entity_1 = world.spawn_empty().id();
        world.entity_mut(entity_1).insert(Transform::from_xy(400.0, 400.0));
        world.entity_mut(entity_1).insert(TextContent { text: "Hello, WASM!".to_string(), ..Default::default() });
        world.entity_mut(entity_1).insert(Style { fill: Some(Color::parse("#ffffff")), stroke: None, ..Default::default() });

    }
}

impl AppComponent {
    /// Create a new component instance
    pub fn new(ctx: &mut Context) -> Self {
        Self::create(ctx)
    }
}

/// WASM Entry Point
#[wasm_bindgen(start)]
pub fn start() -> Result<(), JsValue> {
    console_error_panic_hook::set_once();
    tracing_wasm::set_as_global_default();

    let mut app = omnicraft_runtime::App::new();
    let mut ctx = Context::new();
    let component = AppComponent::new(&mut ctx);
    component.mount(app.world_mut());

    app.tick();

    // Render to canvas
    let mut queue = RenderQueue::new();
    Renderer::render(app.world_mut(), &mut queue);

    let renderer = omnicraft_runtime::render::wasm::CanvasRenderer::new("canvas")?;
    renderer.execute(&queue.commands);

    Ok(())
}
